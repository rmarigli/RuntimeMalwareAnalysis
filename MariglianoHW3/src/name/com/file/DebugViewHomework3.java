package name.com.file;

import java.io.File;
import java.util.Scanner;
import java.util.regex.*;

public class DebugViewHomework3 {

	public static void main(String args[]) throws Exception
	{
		@SuppressWarnings("resource")
		Scanner file = new Scanner(new File("C:\\Homework3Part2v2.log"));
		int numTimes = file.nextInt();
		file.nextLine();
		
		for(int i=0; i<numTimes;i++){
	
			String IRP_read = "@@@ IRP_MJ_READ";
			String IRP_write = "@@@ IRP_MJ_WRITE";
			String IRP_create = "@@@ IRP_MJ_CREATE";
			String IRP_delete = "@@@ IRP_MJ_SET_INFORMATION";
			String PROCESS_VM_WRITE = "@@@ Proces-memory-write-access-attempt";
			String CB_PROCESS_TERMINATE = "@@@ Proces-terminate-attempt";
			String PROCESS_ALL_ACCESS = "@@@ Proces-memory-write-delete-access-attempt";
			String CREATE_KEY = "@@@ RegNtPreCreateKeyEx";
			String SET_VALUE_KEY = "@@@ RegNtPreSetValueKey";
			String DELETE_KEY = "@@@ RegNtDeleteKey";
			String DELETE_VALUE_KEY = "@@@ RegNtDeleteValueKey";
			String RENAME_KEY = "@@@ RegNtPreRenameKey";
			String REPLACE_KEY = "@@@ RegNtPreReplaceKey";
			
			
			if (file.findInLine(IRP_read) != null){
				
				System.out.println("Read detected!");
				String[] found = file.nextLine().split(",");
				String[] value = (found[1].split(" "));
				String[] value1 = (found[2].split(" "));
				String[] value2 = (found[3].split(" "));
				System.out.println("pid: " + value[3]);
				System.out.println("destination address: " + value1[3]);
				System.out.println("source file: " + value2[3]+"\n");
				
				
			}
			//Homework2
			else if (file.findInLine(IRP_write)!= null){
				 
				System.out.println("Write detected!");
				String[] found = file.nextLine().split(",");
				String[] value = (found[1].split(" "));
				String[] value1 = (found[2].split(" "));
				String[] value2 = (found[3].split(" "));
				System.out.println("pid: " + value[3]);
				System.out.println("source address: " + value1[3]);
				System.out.println("destination file: " + value2[3]+"\n");
				
				if (file.findInLine(IRP_create)!= null){
					 
					System.out.println("Modification detected!");
					String[] found3 = file.nextLine().split(",");
					String[] value33 = (found3[1].split(" "));
					String[] value13 = (found3[2].split(" "));
					String[] value23 = (found3[3].split(" "));
					System.out.println("pid: " + value33[3]);
					System.out.println("destination file: " + value13[3]);
					System.out.println("dispostion: " + value23[2]+"\n");	 
				}	 
				 
			}
			else if (file.findInLine(IRP_create)!= null){
				 
				System.out.println("Create detected!");
				String[] found = file.nextLine().split(",");
				String[] value = (found[1].split(" "));
				String[] value1 = (found[2].split(" "));
				String[] value2 = (found[3].split(" "));
				System.out.println("pid: " + value[3]);
				System.out.println("destination file: " + value1[3]);
				System.out.println("dispostion: " + value2[2]+"\n");
				 
			}
			else if (file.findInLine(IRP_delete)!= null){
				 
				System.out.println("Delete detected!");
				String[] found = file.nextLine().split(",");
				String[] value = (found[1].split(" "));
				String[] value1 = (found[2].split(" "));
				String[] value2 = (found[3].split(" "));
				System.out.println("pid: " + value[3]);
				System.out.println("destination file: " + value1[3]);
				System.out.println("dispostion: " + value2[2]+"\n");
				 
			}
			else if (file.findInLine(PROCESS_VM_WRITE)!= null){
				System.out.println("Process_VM_Write Detected");
				String[] found = file.nextLine().split(",");
				String[] value = (found[1].split(" "));
				String[] value1 = (found[2].split(" "));
				String[] value2 = (found[3].split(" "));
				System.out.println("pid: " + value[3]);
				System.out.println("destination file: " + value1[3]);
				System.out.println("dispostion: " + value2[2]+"\n");
				
				if (file.findInLine(IRP_read) != null){
					
					//System.out.println("Read detected!");
					String[] found4 = file.nextLine().split(",");
					String[] value4 = (found4[1].split(" "));
					String[] value14 = (found4[2].split(" "));
					String[] value24 = (found4[3].split(" "));
					
					if (file.findInLine(IRP_write)!= null){
						 
						System.out.println("Self Replication detected!");
						String[] found5 = file.nextLine().split(",");
						String[] value5 = (found5[1].split(" "));
						String[] value15 = (found5[2].split(" "));
						String[] value25 = (found5[3].split(" "));
						System.out.println("pid: " + value5[3]);
						System.out.println("source address: " + value15[3]);
						System.out.println("destination file: " + value25[3]+"\n");
					}
					else if (file.findInLine(IRP_create)!= null){
						 
						System.out.println("Self Replication detected!");
						String[] found6 = file.nextLine().split(",");
						String[] value6 = (found6[1].split(" "));
						String[] value16 = (found6[2].split(" "));
						String[] value26 = (found6[3].split(" "));
						System.out.println("pid: " + value6[3]);
						System.out.println("destination file: " + value16[3]);
						System.out.println("dispostion: " + value26[2]+"\n");
						 
					}

				}
			
			}
			
			
			//Homework 3
			
			else if (file.findInLine(CREATE_KEY)!= null){
				 
				System.out.println("Create Key detected!");
				String[] found = file.nextLine().split(",");
				String[] value = (found[1].split(" "));
				String[] value1 = (found[2].split(" "));
				//String[] value2 = (found[3].split(" "));
				System.out.println("key: " + value[2]);
				System.out.println("PID: " + value1[3]);
				System.out.println("\n");
				if (file.findInLine(SET_VALUE_KEY)!= null){
					 
					//System.out.println("Set Value Key detected!");
					String[] found6 = file.nextLine().split(",");
					String[] value6 = (found6[1].split(" "));
					String[] value16 = (found6[2].split(" "));
					String[] value26 = (found6[3].split(" "));
					if (file.findInLine(DELETE_VALUE_KEY)!= null){
						 
					//	System.out.println("Delete Value Key detected!");
						String[] found61 = file.nextLine().split(",");
						String[] value61 = (found61[1].split(" "));
						String[] value161 = (found61[2].split(" "));
						String[] value261 = (found61[3].split(" "));
						if (file.findInLine(DELETE_KEY)!= null){
							 
							System.out.println("SUSPICIOUS ACTICITY DETECTED!");
							String[] found62 = file.nextLine().split(",");
							String[] value62 = (found62[1].split(" "));
							String[] value126 = (found62[2].split(" "));
							System.out.println("Delete key: " + value62[3]);
							System.out.println("PID: " + value126[3]+"\n");
							 
						}
					}
				}
			}
			else if (file.findInLine(SET_VALUE_KEY)!= null){
				 
				System.out.println("Set Value Key detected!");
				String[] found6 = file.nextLine().split(",");
				String[] value6 = (found6[1].split(" "));
				String[] value16 = (found6[2].split(" "));
				String[] value26 = (found6[3].split(" "));
				System.out.println("Value key: " + value6[3]);
				System.out.println("PID: " + value16[3]);
				System.out.println("New Value: " + value26[4]+"\n");
				 
			}
			else if (file.findInLine(DELETE_KEY)!= null){
				 
				System.out.println("Delete Key detected!");
				String[] found6 = file.nextLine().split(",");
				String[] value6 = (found6[1].split(" "));
				String[] value16 = (found6[2].split(" "));
				System.out.println("Delete key: " + value6[3]);
				System.out.println("PID: " + value16[3]+"\n");
				 
			}
			else if (file.findInLine(DELETE_VALUE_KEY)!= null){
				 
				System.out.println("Delete Value Key detected!");
				String[] found6 = file.nextLine().split(",");
				String[] value6 = (found6[1].split(" "));
				String[] value16 = (found6[2].split(" "));
				String[] value26 = (found6[3].split(" "));
				System.out.println("Delete key: " + value6[2]);
				System.out.println("Delete Key Value name: " + value16[2]);
				System.out.println("PID: " + value26[3]+"\n"); 
			}
			else if (file.findInLine(RENAME_KEY)!= null){
				 
				System.out.println("RENAME Key detected!");
				System.out.println("This could be suspicious!");
				String[] found6 = file.nextLine().split(",");
				String[] value6 = (found6[1].split(" "));
				String[] value16 = (found6[2].split(" "));
				String[] value26 = (found6[3].split(" "));
				System.out.println("Old Object Name: " + value6[4]);
				System.out.println("New Key name: " + value16[4]);
				System.out.println("PID: " + value26[3]+"\n"); 
			}
			else if (file.findInLine(REPLACE_KEY)!= null){
				 
				System.out.println("Repalce Key detected!");
				System.out.println("This could be suspicious!");
				String[] found6 = file.nextLine().split(",");
				String[] value6 = (found6[1].split(" "));
				String[] value16 = (found6[2].split(" "));
				System.out.println("Object Name: " + value6[2]);
				System.out.println("PID: " + value16[3]);
				System.out.println("\n"); 
			}
			
			
			
		
		}
	}
		
	
}